import serial
import speech_recognition as sr
import sounddevice as sd
import wavio as wv

while True:
    try:
        arduino = serial.Serial('COM4', 9600)
        print('Arduino Conectado!')
        break
    except:
        pass
def fala(texto):
    import pyttsx3
    engine = pyttsx3.init()
    voices = engine.getProperty('voices')
    engine.setProperty('voice', voices[0].id)
    engine.say(texto)
    engine.runAndWait()

def grava():
    freq = 48000
    duration = 5
    recording = sd.rec(int(duration * freq), samplerate=freq, channels=2)
    print('Fale agora!')
    sd.wait()
    wv.write('minhavoz.wav', recording, freq, sampwidth=2)
    print('Ok, processando...')
filename = 'minhavoz.wav'

while True:
    grava()
    r = sr.Recognizer()

    try:
        with sr.AudioFile(filename) as source:
            audio_data = r.record(source)
            says = r.recognize_google(audio_data, language='pt-BR')
            print('VocÃª disse: ' + says.lower())
            msg = says.lower()
        if 'ligar luz' in msg or 'acender luz' in msg:
            arduino.write('2'.encode())
            fala('Luz ligada!')
        elif 'desligar luz' in msg or 'apagar luz' in msg:
            arduino.write('1'.encode())
            fala('Luz desligada!')

            arduino.flush()

    except Exception as e:
        print(e)
